openapi: 3.0.0
info:
  title: UMC 9th - Node.js A팀의 Mont
  description: |
    UMC 9기 Node.js A팀 Mont 프로젝트 API 문서
    
    ## 에러 코드
    - U001: 이미 존재하는 이메일
    - U002: 이미 존재하는 가게
    - U003: 존재하지 않는 가게
    - U004: 존재하지 않는 미션
    - U005: 이미 도전중인 미션
    - U006: 이미 완료된 미션
  version: 1.0.0
  contact:
    name: Mont Team
    
servers:
  - url: http://localhost:3000
    description: 개발 서버

tags:
  - name: Users
    description: 사용자 관련 API
  - name: Stores
    description: 가게 관련 API
  - name: Reviews
    description: 리뷰 관련 API
  - name: Missions
    description: 미션 관련 API
  - name: Auth
    description: 인증 관련 API

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT 액세스 토큰을 입력해주세요
      
  schemas:
    # 공통 응답 스키마
    SuccessResponse:
      type: object
      properties:
        resultType:
          type: string
          example: SUCCESS
        error:
          type: object
          nullable: true
          example: null
        success:
          type: object
          
    ErrorResponse:
      type: object
      properties:
        resultType:
          type: string
          example: FAIL
        error:
          type: object
          properties:
            errorCode:
              type: string
              description: 에러 코드
            reason:
              type: string
              description: 에러 사유
            data:
              type: object
              nullable: true
              description: 추가 에러 데이터
        success:
          type: object
          nullable: true
          example: null
          
    # User 스키마
    User:
      type: object
      properties:
        id:
          type: integer
          format: int64
          example: 1
        email:
          type: string
          format: email
          example: user@example.com
        name:
          type: string
          example: 홍길동
        gender:
          type: string
          enum: [M, F]
          example: M
        birth:
          type: string
          format: date
          example: "1990-01-01"
        address:
          type: string
          example: 서울시 강남구
        detailAddress:
          type: string
          example: 101동 1001호
        phoneNumber:
          type: string
          example: "01012345678"
        createdAt:
          type: string
          format: date-time
          
    # Store 스키마
    Store:
      type: object
      properties:
        id:
          type: integer
          format: int64
          example: 1
        name:
          type: string
          example: 김밥천국 강남점
        address:
          type: string
          example: 서울시 강남구 테헤란로
        category:
          type: string
          example: 한식
        phone:
          type: string
          example: "02-1234-5678"
        rating:
          type: number
          format: float
          example: 4.5
        createdAt:
          type: string
          format: date-time
          
    # Review 스키마
    Review:
      type: object
      properties:
        id:
          type: integer
          format: int64
          example: 1
        storeId:
          type: integer
          format: int64
          example: 1
        userId:
          type: integer
          format: int64
          example: 1
        content:
          type: string
          example: 맛있고 친절합니다!
        score:
          type: number
          format: float
          minimum: 0
          maximum: 5
          example: 4.5
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
          
    # Mission 스키마
    Mission:
      type: object
      properties:
        id:
          type: integer
          format: int64
          example: 1
        storeId:
          type: integer
          format: int64
          example: 1
        title:
          type: string
          example: 방문 후 인증샷 올리기
        description:
          type: string
          example: 가게 방문 후 인증샷을 올려주세요
        reward:
          type: integer
          example: 100
        createdAt:
          type: string
          format: date-time
          
    # UserMission 스키마
    UserMission:
      type: object
      properties:
        id:
          type: integer
          format: int64
          example: 1
        userId:
          type: integer
          format: int64
          example: 1
        missionId:
          type: integer
          format: int64
          example: 1
        status:
          type: string
          enum: [ONGOING, COMPLETED]
          example: ONGOING
        createdAt:
          type: string
          format: date-time
        completedAt:
          type: string
          format: date-time
          nullable: true

  responses:
    # 공통 에러 응답
    BadRequest:
      description: 잘못된 요청
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          examples:
            duplicateEmail:
              summary: 이메일 중복
              value:
                resultType: FAIL
                error:
                  errorCode: U001
                  reason: 이미 존재하는 이메일입니다.
                  data: null
                success: null
            storeAlreadyExists:
              summary: 가게 중복
              value:
                resultType: FAIL
                error:
                  errorCode: U002
                  reason: 이미 존재하는 가게입니다.
                  data: null
                success: null
            storeNotFound:
              summary: 가게 없음
              value:
                resultType: FAIL
                error:
                  errorCode: U003
                  reason: 존재하지 않는 가게입니다.
                  data: null
                success: null
            missionNotFound:
              summary: 미션 없음
              value:
                resultType: FAIL
                error:
                  errorCode: U004
                  reason: 존재하지 않는 미션입니다.
                  data: null
                success: null
            missionAlreadyOngoing:
              summary: 미션 이미 도전중
              value:
                resultType: FAIL
                error:
                  errorCode: U005
                  reason: 이미 도전중인 미션입니다.
                  data: null
                success: null
            missionAlreadyCompleted:
              summary: 미션 이미 완료
              value:
                resultType: FAIL
                error:
                  errorCode: U006
                  reason: 이미 완료된 미션입니다.
                  data: null
                success: null
                
    Unauthorized:
      description: 인증 실패
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            resultType: FAIL
            error:
              errorCode: UNAUTHORIZED
              reason: 인증이 필요합니다.
              data: null
            success: null
            
    InternalServerError:
      description: 서버 내부 오류
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            resultType: FAIL
            error:
              errorCode: INTERNAL_SERVER_ERROR
              reason: 서버에서 오류가 발생했습니다.
              data: null
            success: null

paths:
  # ==================== Auth APIs ====================
  /oauth2/login/google:
    get:
      summary: Google OAuth2 로그인
      tags: [Auth]
      description: Google OAuth2 인증을 시작합니다
      responses:
        '302':
          description: Google 로그인 페이지로 리디렉션
        '500':
          $ref: '#/components/responses/InternalServerError'
          
  /oauth2/callback/google:
    get:
      summary: Google OAuth2 콜백
      tags: [Auth]
      description: Google 인증 후 콜백을 처리하고 JWT 토큰을 발급합니다
      responses:
        '200':
          description: 로그인 성공
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      success:
                        type: object
                        properties:
                          access_token:
                            type: string
                            description: JWT 액세스 토큰
                          refresh_token:
                            type: string
                            description: JWT 리프레시 토큰
                          user:
                            $ref: '#/components/schemas/User'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalServerError'
          
  /api/v1/mypage:
    get:
      summary: 마이페이지
      tags: [Auth]
      description: 인증된 사용자의 마이페이지 정보를 조회합니다
      security:
        - bearerAuth: []
      responses:
        '200':
          description: 마이페이지 조회 성공
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      success:
                        type: object
                        properties:
                          message:
                            type: string
                            example: 인증 성공! 홍길동님의 마이페이지입니다.
                          user:
                            $ref: '#/components/schemas/User'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

  # ==================== User APIs ====================
  /api/v1/users/signup:
    post:
      summary: 회원가입
      tags: [Users]
      description: |
        새로운 사용자를 등록합니다.
        
        **발생 가능한 에러:**
        - U001: 이미 존재하는 이메일 (DuplicateUserEmailError - userRepository.addUser)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
                - name
              properties:
                email:
                  type: string
                  format: email
                  example: user@example.com
                password:
                  type: string
                  format: password
                  example: securePassword123
                name:
                  type: string
                  example: 홍길동
                gender:
                  type: string
                  enum: [M, F]
                  example: M
                birth:
                  type: string
                  format: date
                  example: "1990-01-01"
                address:
                  type: string
                  example: 서울시 강남구
                detailAddress:
                  type: string
                  example: 101동 1001호
                phoneNumber:
                  type: string
                  example: "01012345678"
                preferences:
                  type: array
                  items:
                    type: string
                  example: ["한식", "중식"]
      responses:
        '200':
          description: 회원가입 성공
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      success:
                        $ref: '#/components/schemas/User'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalServerError'
          
  /api/v1/users/profile:
    patch:
      summary: 프로필 업데이트
      tags: [Users]
      description: |
        인증된 사용자의 프로필 정보를 업데이트합니다.
        Google OAuth로 가입한 사용자가 추가 정보를 입력할 때 사용합니다.
        
        **발생 가능한 에러:**
        - 데이터베이스 업데이트 실패 시 일반 에러 (userRepository.updateUser)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  example: 홍길동
                gender:
                  type: string
                  enum: [M, F]
                  example: M
                birth:
                  type: string
                  format: date
                  example: "1990-01-01"
                address:
                  type: string
                  example: 서울시 강남구
                detailAddress:
                  type: string
                  example: 101동 1001호
                phoneNumber:
                  type: string
                  example: "01012345678"
      responses:
        '200':
          description: 프로필 업데이트 성공
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      success:
                        $ref: '#/components/schemas/User'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

  # ==================== Store APIs ====================
  /api/v1/stores/add:
    post:
      summary: 가게 추가
      tags: [Stores]
      description: |
        새로운 가게를 등록합니다.
        
        **발생 가능한 에러:**
        - U002: 이미 존재하는 가게 (StoreAlreadyExistsError - storeRepository.addStore)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - address
              properties:
                name:
                  type: string
                  example: 김밥천국 강남점
                address:
                  type: string
                  example: 서울시 강남구 테헤란로
                category:
                  type: string
                  example: 한식
                phone:
                  type: string
                  example: "02-1234-5678"
      responses:
        '200':
          description: 가게 추가 성공
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      success:
                        type: object
                        properties:
                          result:
                            $ref: '#/components/schemas/Store'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'
          
  /api/v1/stores/{storeId}/reviews:
    get:
      summary: 가게 리뷰 목록 조회
      tags: [Stores]
      description: |
        특정 가게의 리뷰 목록을 조회합니다.
        
        **발생 가능한 에러:**
        - U003: 존재하지 않는 가게 (StoreNotFoundError - storeRepository.getStore)
      parameters:
        - name: storeId
          in: path
          required: true
          description: 가게 ID
          schema:
            type: integer
            format: int64
            example: 1
      responses:
        '200':
          description: 리뷰 목록 조회 성공
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      success:
                        type: object
                        properties:
                          result:
                            type: array
                            items:
                              $ref: '#/components/schemas/Review'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalServerError'

  # ==================== Review APIs ====================
  /api/v1/reviews/add:
    post:
      summary: 리뷰 추가
      tags: [Reviews]
      description: |
        특정 가게에 리뷰를 작성합니다.
        인증된 사용자의 ID는 JWT 토큰에서 자동으로 추출됩니다.
        
        **발생 가능한 에러:**
        - U003: 존재하지 않는 가게 (StoreNotFoundError - reviewRepository.addReview에서 FK 제약조건)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - storeId
                - content
              properties:
                storeId:
                  type: integer
                  format: int64
                  example: 1
                content:
                  type: string
                  example: 맛있고 친절합니다!
                score:
                  type: number
                  format: float
                  minimum: 0
                  maximum: 5
                  example: 4.5
      responses:
        '200':
          description: 리뷰 추가 성공
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      success:
                        type: object
                        properties:
                          result:
                            $ref: '#/components/schemas/Review'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

  # ==================== Mission APIs ====================
  /api/v1/missions/add:
    post:
      summary: 미션 추가
      tags: [Missions]
      description: |
        특정 가게에 새로운 미션을 추가합니다.
        
        **발생 가능한 에러:**
        - U003: 존재하지 않는 가게 (StoreNotFoundError - missionRepository.addMission에서 FK 제약조건)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - storeId
                - title
                - description
                - reward
              properties:
                storeId:
                  type: integer
                  format: int64
                  example: 1
                title:
                  type: string
                  example: 방문 후 인증샷 올리기
                description:
                  type: string
                  example: 가게 방문 후 인증샷을 올려주세요
                reward:
                  type: integer
                  example: 100
      responses:
        '200':
          description: 미션 추가 성공
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      success:
                        type: object
                        properties:
                          result:
                            $ref: '#/components/schemas/Mission'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'
          
  /api/v1/user-missions/add:
    post:
      summary: 유저 미션 추가
      tags: [Missions]
      description: |
        사용자가 미션에 도전합니다.
        인증된 사용자의 ID는 JWT 토큰에서 자동으로 추출됩니다.
        
        **발생 가능한 에러:**
        - U004: 존재하지 않는 미션 (MissionNotFoundError - userMissionRepository.getUserMissionByMissionAndUserId)
        - U005: 이미 도전중인 미션 (MissionAlreadyOngoingError - userMissionRepository.getUserMissionByMissionAndUserId에서 상태 확인)
        - U006: 이미 완료된 미션 (MissionAlreadyCompletedError - userMissionRepository.getUserMissionByMissionAndUserId에서 상태 확인)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - missionId
              properties:
                missionId:
                  type: integer
                  format: int64
                  example: 1
      responses:
        '200':
          description: 유저 미션 추가 성공
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      success:
                        type: object
                        properties:
                          result:
                            $ref: '#/components/schemas/UserMission'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'
