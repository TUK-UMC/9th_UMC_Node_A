// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id            Int      @id @default(autoincrement())
  
  // 필수 필드
  email         String   @unique @db.VarChar(255)
  // 추가: 비밀번호 해싱 미션을 반영
  password      String   @db.VarChar(255) 

  name          String   @db.VarChar(100)
  gender        String   @db.VarChar(15)
  birth         DateTime @db.Date
  
  // NULL 허용 필드 (스크린샷에서 NULL 값이 관찰됨)
  address       String?  @db.VarChar(255) // String 뒤에 ? 추가 (NULL 허용)
  
  // detail_address는 DB에 NULL이 있으므로 Optional(?)로 정의
  detailAddress String?  @map("detail_address") @db.VarChar(255) 
  
  // phone_number도 DB에 NULL이 있으므로 Optional(?)로 정의
  phoneNumber   String?  @map("phone_number") @db.VarChar(15) 

  userFavorCategories UserFavorCategory[]

  reviews             UserStoreReview[]

  userMissions        UserMission[]

  // (관계 필드: UserFavorCategory, Review, Mission 등은 필요시 여기에 추가되어야 합니다.)

  @@map("user") // 실제 DB 테이블 이름
}

model FoodCategory {
  id   Int    @id @default(autoincrement())
  name String @db.VarChar(100)

  userFavorCategories UserFavorCategory[]

  @@map("food_category")
}

// [추가] N:M 관계를 위한 중간 테이블 모델
model UserFavorCategory {
  id             Int          @id @default(autoincrement())
  
  // User 관계 설정
  user           User         @relation(fields: [userId], references: [id])
  userId         Int          @map("user_id") // DB 컬럼: user_id
  
  // FoodCategory 관계 설정
  category       FoodCategory @relation(fields: [categoryId], references: [id])
  categoryId     Int          @map("food_category_id") // DB 컬럼: food_category_id

  @@index([categoryId], map: "f_category_id")
  @@index([userId], map: "user_id")
  @@map("user_favor_category") // 실제 DB 테이블 이름
}

/// prisma/schema.prisma (Store 모델 수정)

model Store {
  id      Int    @id @default(autoincrement())
  name    String @db.VarChar(100)
  
  address String? @db.VarChar(255) 
  rating  Decimal? @db.Decimal(2, 1) 
  regionId Int?     

  reviews UserStoreReview[] 
  // [필수 추가] Mission 모델과의 관계를 명시합니다. (1:N)
  missions Mission[] 

  @@map("store")
}

// prisma/schema.prisma (UserStoreReview 모델 수정)
model UserStoreReview {
  id        Int     @id @default(autoincrement())
  
  rating    Decimal @default(4.0) @db.Decimal(2, 1) 
  content   String  @db.Text
  
  // [추가] 생성 일시 필드 추가
  createdAt DateTime @default(now()) @map("created_at") // DB 컬럼명을 created_at으로 매핑
  
  user      User    @relation(fields: [userId], references: [id])
  userId    Int     @map("user_id") 

  store     Store   @relation(fields: [storeId], references: [id])
  storeId   Int     @map("store_id") 

  @@map("user_store_review")
}

// prisma/schema.prisma (Mission 모델 확인)
model Mission {
  id      Int      @id @default(autoincrement())
  storeId Int      @map("store_id") // Store 모델의 ID를 참조
  title   String   @db.VarChar(255)
  content String   @db.Text
  status  String   @default("ACTIVE")

  store Store @relation(fields: [storeId], references: [id]) // Store와의 관계

  userMissions        UserMission[]

  @@map("mission") // 실제 DB 테이블 이름
}
// Store 모델에도 reviews와 유사하게 missions Mission[] 관계가 정의되어 있어야 합니다.

// [누락된 모델 추가] UserMission 모델
model UserMission {
  id        Int      @id @default(autoincrement())
  
  // 상태 및 외래키 필드
  status    String   @default("IN_PROGRESS") @db.VarChar(20)
  
  // User 관계
  user      User     @relation(fields: [userId], references: [id])
  userId    Int      @map("user_id")

  // Mission 관계
  mission   Mission  @relation(fields: [missionId], references: [id])
  missionId Int      @map("mission_id")
  
  // 도전 중복 방지 (선택적)
  @@unique([userId, missionId]) 

  @@map("user_mission")
}